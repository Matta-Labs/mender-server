name: gui-tests
services:
  gui-tests-runner:
    image: mendersoftware/mender-test-containers:gui-e2e-testing
    command: tail -f /dev/null
    environment:
      - TEST_ENVIRONMENT
      - NODE_TLS_REJECT_UNAUTHORIZED=0
    networks:
      - default
    depends_on:
      - client
      - create-artifact-worker
      - deployments
      - deviceauth
      - gui
      - inventory
      - useradm
      - workflows
      - workflows-worker
      - mongo
      - nats
      - s3fs
      - traefik
    volumes:
      - ${GUI_REPOSITORY}/coverage:/e2e/coverage
      - ${GUI_REPOSITORY}/junit:/e2e/junit
      - ${GUI_REPOSITORY}/logs:/root/.npm/_logs
      - ${GUI_REPOSITORY}/screenshots:/e2e/test-results
      - ${GUI_REPOSITORY}/tests/e2e_tests/dockerClient:/e2e/dockerClient
      - ${GUI_REPOSITORY}/tests/e2e_tests/fixtures:/e2e/fixtures
      - ${GUI_REPOSITORY}/tests/e2e_tests/integration:/e2e/integration
      - ${GUI_REPOSITORY}/tests/e2e_tests/package.json:/e2e/package.json
      - ${GUI_REPOSITORY}/tests/e2e_tests/playwright.config.ts:/e2e/playwright.config.ts
      - ${GUI_REPOSITORY}/tests/e2e_tests/utils:/e2e/utils
      - ${GUI_REPOSITORY}/videos:/e2e/videos

  client:
    image: mendersoftware/mender-client-docker-addons:mender-master
    volumes:
      - ${GUI_REPOSITORY}/tests/e2e_tests/dockerClient/mender.json:/etc/mender/mender.conf
      - ${GUI_REPOSITORY}/tests/e2e_tests/dockerClient/mender-connect.json:/etc/mender/mender-connect.conf

  create-artifact-worker:
    image: mendersoftware/create-artifact-worker:main
  deployments:
    image: mendersoftware/deployments:main
  deviceauth:
    image: mendersoftware/deviceauth:main
  deviceconfig:
    image: mendersoftware/deviceconfig:main
  deviceconnect:
    image: mendersoftware/deviceconnect:main
  inventory:
    image: mendersoftware/inventory:main
  iot-manager:
    image: mendersoftware/iot-manager:main
  useradm:
    image: mendersoftware/useradm:main
  workflows:
    image: mendersoftware/workflows:main
  workflows-worker:
    image: mendersoftware/workflows:main

  traefik:
    networks:
      default:
        aliases: [s3.localhost, docker.mender.io]

  ##
  ## to execute or edit the tests locally:
  ## use playwright locally using `npm install` in the e2e_tests directory and run `npm run test`
  ##
  gui:
    image: mendersoftware/gui:pr
    environment:
      - GATEWAY_IP=docker.mender.io
      - DISABLE_ONBOARDING=true
      - HAVE_REPORTING=0
